name: Build Release

on:
  release:
    types: [published]

jobs:
  build-windows:
    uses: ./.github/workflows/windows/build_release.yml
    with:
      version: ${{ github.event.release.tag_name }}

  build-wiiu:
    uses: ./.github/workflows/wiiu/build_release.yml
    with:
      version: ${{ github.event.release.tag_name }}

  attach-to-release:
    name: Attach To Release
    needs: [build-windows, build-wiiu]
    runs-on: ubuntu-latest
 
    steps:
     - name: Download Windows Artifact
       uses: actions/download-artifact@v3
       with:
        name: wwhd_rando_${{ github.event.release.tag_name }}_windows.zip # pass name so it doesn't get put in a folder

     - name: Download Wii U Artifact
       uses: actions/download-artifact@v3
       with:
        name: wwhd_rando_${{ github.event.release.tag_name }}.wuhb # pass name so it doesn't get put in a folder

     - name: Attach Files
       env:
        GITHUB_TOKEN: ${{ github.TOKEN }}
       run: gh release upload ${{ github.event.release.tag_name }} wwhd_rando_${{ github.event.release.tag_name }}_windows.zip wwhd_rando_${{ github.event.release.tag_name }}.wuhb
